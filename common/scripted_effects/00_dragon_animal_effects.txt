#Effects used in animal events


#####################################################################
# EFFECT LIST
#####################################################################
# !!! Remember to add all new effects here !!!
#

# CAT
#start_cat_story_cycle_effect
#assign_name_options_cat_story_cycle_effect
#assign_cat_gender_effect
#assign_cat_fur_color_effect
#assign_cat_eye_color_effect
#remove_cat_story_modifiers_effect
#transfer_cat_story_cycle_to_effect

#dragon
#start_dragon_story_cycle_effect
#assign_name_options_dragon_story_cycle_effect
#assign_dragon_gender_effect
#assign_dragon_fur_color_effect
#assign_dragon_eye_color_effect
#dragon_got_pregnant_effect
#remove_dragon_story_modifiers_effect
#transfer_dragon_story_cycle_to_effect

#WARHORSE
#start_warhorse_story_cycle_effect
#assign_horse_gender_effect
#level_horse_modifier_effect
#remove_horse_story_modifiers_effect

######################################################################
# EFFECTS
######################################################################

########
# dragon
########

#Effect to start the story and show the right modifier
start_dragon_story_cycle_effect = {
	show_as_tooltip = {
		add_character_modifier = {
			modifier = dragon_story_modifier
		}
	}
	hidden_effect = {
		create_story = story_cycle_pet_dragon
	}
}

#Pick out name options to show
assign_name_options_dragon_story_cycle_effect = {
	random_list = {
		1 = {
			trigger = { NOT = { has_character_flag = name_amiable } }
			add_character_flag = name_amiable
		}
		1 = {
			trigger = { NOT = { has_character_flag = name_nosewise } }
			add_character_flag = name_nosewise
		}
		1 = {
			trigger = { NOT = { has_character_flag = name_holdfast } }
			add_character_flag = name_holdfast
		}
		10 = {
			trigger = {
				NOT = { has_character_flag = name_gray }
				scope:story.var:dragon_fur_color = flag:gray
			}
			add_character_flag = name_gray
		}
		10 = {
			trigger = {
				NOT = { has_character_flag = name_choplicker }
				scope:story.var:dragon_fur_color = flag:black
			}
			add_character_flag = name_choplicker
		}
		10 = {
			trigger = {
				NOT = { has_character_flag = name_shadow }
				scope:story.var:dragon_fur_color = flag:black
			}
			add_character_flag = name_shadow
		}
		10 = {
			trigger = {
				NOT = { has_character_flag = name_snow }
				scope:story.var:dragon_fur_color = flag:white
			}
			add_character_flag = name_snow
		}
	}
}

#Assign the gender of the dragon
assign_dragon_gender_effect = {
	save_temporary_scope_value_as = {
		name = gender
		value = flag:$GENDER$
	}
	if = {
		limit = { scope:gender = flag:random }
		hidden_effect = {
			random_list = {
				50 = {
					set_variable = {
						name = dragon_gender
						value = flag:female
					}
				}
				50 = {
					set_variable = {
						name = dragon_gender
						value = flag:male
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				scope:gender = flag:male
				scope:gender = flag:female
			}
		}
		set_variable = {
			name = dragon_gender
			value = flag:$GENDER$
		}
	}
}

#Assign the fur-color of the dragon
assign_dragon_fur_color_effect = {
	save_temporary_scope_value_as = {
		name = fur_color
		value = flag:$COLOR$
	}
	if = {
		limit = { scope:fur_color = flag:random }
		hidden_effect = {
			random_list = {
				50 = {
					set_variable = {
						name = dragon_fur_color
						value = flag:brown
					}
				}
				50 = {
					set_variable = {
						name = dragon_fur_color
						value = flag:gray
					}
				}
				50 = {
					set_variable = {
						name = dragon_fur_color
						value = flag:black
					}
				}
				50 = {
					set_variable = {
						name = dragon_fur_color
						value = flag:white
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				scope:fur_color = flag:brown
				scope:fur_color = flag:gray
				scope:fur_color = flag:black
				scope:fur_color = flag:white
			}
		}
		set_variable = {
			name = dragon_fur_color
			value = flag:$COLOR$
		}
	}
}

#Assign the eye-color of the dragon
assign_dragon_eye_color_effect = {
	save_temporary_scope_value_as = {
		name = eye_color
		value = flag:$COLOR$
	}
	if = {
		limit = { scope:eye_color = flag:random }
		hidden_effect = {
			random_list = {
				50 = {
					set_variable = {
						name = dragon_eye_color
						value = flag:blue
					}
				}
				50 = {
					set_variable = {
						name = dragon_eye_color
						value = flag:amber
					}
				}
				50 = {
					set_variable = {
						name = dragon_eye_color
						value = flag:gray
					}
				}
				50 = {
					set_variable = {
						name = dragon_eye_color
						value = flag:brown
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				scope:eye_color = flag:blue
				scope:eye_color = flag:amber
				scope:eye_color = flag:gray
				scope:eye_color = flag:brown
			}
		}
		set_variable = {
			name = dragon_eye_color
			value = flag:$COLOR$
		}
	}
}

dragon_got_pregnant_effect = {
	custom_tooltip = dragon_got_pregnant_tooltip
	trigger_event = {
		id = pet_dragon_animal.1190
		days = { 58 68 }
	}
}

#Remove everything related to the story
remove_dragon_story_modifiers_effect = {
	if = {
		limit = {
			has_character_modifier = dragon_story_modifier
		}
		remove_character_modifier = dragon_story_modifier
	}
	if = {
		limit = {
			has_character_modifier = dragon_story_walking_modifier
		}
		remove_character_modifier = dragon_story_walking_modifier
	}
	if = {
		limit = {
			has_character_modifier = rat_hunting_dragon_modifier
		}
		remove_character_modifier = rat_hunting_dragon_modifier
	}
}

remove_dragon_name_effect = {
	remove_variable = story_cycle_dragon_name
	remove_localized_text = story_cycle_dragon_name
}

#Effect to transfer the story to another character
transfer_dragon_story_cycle_to_effect = {
	remove_dragon_story_modifiers_effect = yes

	save_temporary_scope_as = original_owner

	$CHARACTER$ = {
		set_variable = {
			name = story_cycle_dragon_name
			value = $STORY$.var:story_cycle_dragon_name
		}
		if = {
			limit = {
				scope:original_owner = { is_alive = yes }
			}
			copy_localized_text = {
				key = story_cycle_dragon_name
				target = scope:original_owner
			}
		}
		add_character_modifier = {
			modifier = dragon_story_modifier
		}
		add_character_flag = had_dragon_story
	}

	remove_dragon_name_effect = yes

	$STORY$ = {
		make_story_owner = $CHARACTER$
	}
}