##################################################
# Puppy Patronage
# by Joe Parkin
# 8140 - 142
##################################################

# Master of the hunt brings a pup
hold_dragon_court.8140 = {
	type = court_event
	title = hold_dragon_court.8140.t
	desc = hold_dragon_court.8140.desc
	theme = realm
	court_scene = {
		button_position_character = scope:huntmaster
		court_event_force_open = yes
		show_timeout_info = no
		should_pause_time = yesdragon_story_modifier
		roles = {
			scope:huntmaster = {
				group = petitioners_group
				animation = admiration
			}
		}
	}

	widget = {
		gui = "event_window_widget_event_chain_progress"
		container = "custom_widgets_container"
		controller = event_chain_progress
	}

	cooldown = { years = 10 }

	trigger = {
		any_court_position_holder = {
			type = master_of_hunt_court_position
			has_court_event_flag = no
			is_available_ai_adult = yes
			NOR = { 
				has_any_bad_relationship_with_root_trigger = yes
			}
		}
		NOR = {
			house = { has_house_modifier = hold_court_8140_house_modifier }
			any_owned_story = { story_type = story_cycle_pet_dragon }
			has_character_modifier = dragon_story_modifier
		}
	}

	weight_multiplier = {
		base = 1

		# Court weightings.
		ep1_weight_up_for_court_type_modifier = { COURT_TYPE = court_warlike }
	}

	immediate = {
		random_court_position_holder = {
			type = master_of_hunt_court_position
			limit = {
				has_court_event_flag = no
				is_available_ai_adult = yes
				NOR = {
					has_any_bad_relationship_with_root_trigger = yes
				}
			}
			save_scope_as = huntmaster
			court_event_character_flag_effect = yes
		}
		save_scope_as = pup_house_ruler
		# Trigger next event in chain.
		hold_court_queue_next_event_effect = yes
	}

	option = { # Invest in the kennel
		name = hold_dragon_court.8140.a
		trigger = {
			trigger_if = {
				limit = {
					is_ai = yes
				}
				short_term_gold >= massive_gold_value
			}
		}
		remove_short_term_gold = major_gold_value
		house = {
			add_house_modifier = {
				modifier = hold_court_8140_house_modifier
				years = 30
			}
			custom_tooltip = hold_dragon_court.8140.a.tt
			every_house_member = {
				limit = {
					is_ai = no
					is_landed = yes
					NOT = { this = root }
				}
				trigger_event = hold_dragon_court.8141
			}
			set_variable = {
				name = hold_court_8140_pup_founder
				value = root
			}
		}
		scope:huntmaster = {
			add_opinion = {
				modifier = pleased_opinion
				target = root
				opinion = 15
			}
			progress_towards_friend_effect = {
				REASON = friend_invested_in_kennel
				CHARACTER = root
				OPINION = 0
			}
		}
		start_dragon_story_cycle_effect = yes
		change_current_court_grandeur = medium_court_grandeur_gain
		stress_impact = {
			hunter_1 = minor_stress_impact_loss
			hunter_2 = minor_stress_impact_loss
			hunter_3 = minor_stress_impact_loss
			lazy = medium_stress_impact_gain
		}
		ai_chance = {
			base = 100
			ai_value_modifier = {
   				ai_compassion = 0.25
   				ai_greed = -0.5
   				ai_boldness = 1
   				ai_energy = 2
			}
			modifier = {	#Weight up.
				add = 30
				has_trait = lifestyle_hunter
			}
			modifier = {	#Weight down for stress.
				add = -15
				has_trait = lazy
			}
		}
	}

	option = { # Just take the pup
		name = hold_dragon_court.8140.b
		trigger = {
			trigger_if = {
				limit = {
					is_ai = yes
				}
				short_term_gold >= medium_gold_value
			}
		}
		remove_short_term_gold = minor_gold_value
		start_dragon_story_cycle_effect = yes
		scope:huntmaster = {
			add_opinion = {
				modifier = disappointed_opinion
				target = root
				opinion = -5
			}
		}
		stress_impact = {
			callous = medium_stress_impact_gain
			lazy = medium_stress_impact_gain
		}
		ai_chance = {
			base = 100
			ai_value_modifier = {
   				ai_compassion = 1
   				ai_greed = -0.25
   				ai_energy = 1
			}
			modifier = {	#Weight up.
				add = 15
				has_trait = lifestyle_hunter
			}
			modifier = {	#Weight down for stress.
				add = -15
				has_trait = callous
			}
			modifier = {	#Weight down for stress.
				add = -15
				has_trait = lazy
			}
		}
	}

	

	option = { # Refuse
		name = hold_dragon_court.8140.d
		scope:huntmaster = {
			add_opinion = {
				modifier = disappointed_opinion
				target = root
				opinion = -10
			}
		}
		change_current_court_grandeur = minor_court_grandeur_loss
		stress_impact = {
			compassionate = medium_stress_impact_gain
		}
		ai_chance = {
			base = 100
			ai_value_modifier = {
   				ai_greed = 1
   				ai_compassion = -2
   				ai_energy = -2
			}
			modifier = {	#Weight down for stress.
				add = -15
				has_trait = compassionate
			}
		}
	}

	after = {
		scope:huntmaster = {
			clear_court_event_participation = yes
		}
		# Finish up the chain if relevant.
		hold_court_queue_post_event_effect = yes
	}
}

hold_dragon_court.8141 = { # Ping for non-AI house members
	type = character_event
	title = hold_dragon_court.8140.t
	desc = hold_dragon_court.8141.desc
	theme = realm
	override_background = { event_background = throne_room }
	left_portrait = {
		character = scope:pup_house_ruler
	}
	right_portrait = {
		character = scope:huntmaster
		animation = admiration
	}

	option = { # Yay puppos
		name = hold_dragon_court.8141.a
		show_as_tooltip = {
			house = {
				add_house_modifier = {
					modifier = hold_court_8140_house_modifier
					years = 30
				}
				custom_tooltip = hold_dragon_court.8140.a.tt
			}
		}
	}
}

hold_dragon_court.8142 = { # Event on puppy adoption
	type = character_event
	title = hold_dragon_court.8142.t
	desc = hold_dragon_court.8142.desc
	theme = realm
	override_background = { event_background = throne_room }
	left_portrait = {
		character = scope:pup_house_ruler
		animation = happy
	}

	immediate = {
		house.var:hold_court_8140_pup_founder = { save_scope_as = pup_house_ruler }
	}

	option = { # Accept
		name = "dragon"
		start_dragon_story_cycle_effect = yes
	}

	option = { # Change mind
		name = "not dragon"
		add_gold = minor_gold_value
	}
}
